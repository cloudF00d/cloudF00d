<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ohgiraffers.semiproject.order.model.dao.CartMapper">


    <resultMap id="CartResultMap" type="com.ohgiraffers.semiproject.order.model.dto.CartDTO">
        <id property="code" column="CART_CODE"/>
        <result property="status" column="USAGE_STATUS"/>
        <association property="memberCode" resultMap="MemberMap"/>
        <association property="projectCode" resultMap="ProjectResultMap"/>
        <association property="projectOptionCode" resultMap="ProjectOptionResultMap"/>
    </resultMap>



    <resultMap id="cartInsertResultMap" type="com.ohgiraffers.semiproject.order.model.dto.CartInsertDTO">
        <id property="userCode" column="USER_CODE"/>
        <id property="cartCode" column="USER_CODE"/>
        <result property="userId" column="CART_CODE"/>
        <result property="projectTitle" column="PROJECT_TITLE"/>
        <result property="optionName" column="OPTION_NAME"/>
        <result property="price" column="PRICE"/>
        <result property="configure" column="CONFIGURE"/>
        <result property="amount" column="TOTAL_AMOUNT"/>
        <result property="optionType" column="OPTION_TYPE"/>
        <result property="coupon" column="COUPON_STATUS"/>
        <result property="end" column="PROJECT_END_DATE"/>
        <result property="start" column="PROJECT_START_DATE"/>

    </resultMap>





    <select id="cartPage" resultMap="cartInsertResultMap">
        select
            A.CART_CODE,
            B.COUPON_STATUS,
            C.PROJECT_TITLE,
            C.PROJECT_END_DATE,
            C.PROJECT_START_DATE,
            D.OPTION_TYPE,
            D.PRICE,
            D.CONFIGURE

            FROM tbl_cart A
                JOIN tbl_user B ON (A.USER_CODE = B.USER_CODE)
                JOIN tbl_project C ON (A.PROJECT_CODE = C.PROJECT_CODE)
                JOIN tbl_project_option D ON (A.OPTION_CODE = D.OPTION_CODE)
                JOIN tbl_payment_history E ON (A.CART_CODE = E.CART_CODE)
        WHERE B.USER_ID =#{userId}
    </select>

<!--parameterType="com.ohgiraffers.semiproject.order.model.dto.CartDTO"-->
    <insert id="addToCart">
        insert
        into tbl_cart (
            user_code,
            project_code,
            option_code,
            usage_status
        )
        values (

                   #{userCode},
                   #{code},
                   #{optionCode},
                   default
               )
    </insert>

    <insert id="insertCart" parameterType="hashmap">
        insert
        into tbl_cart (

            user_code,
            project_code,
            option_code,
            usage_status
        )
        values (

                   #{userCode},
                   #{projectCode},
                   #{projectOptionCode},
                   #{status}
               )
    </insert>




</mapper>