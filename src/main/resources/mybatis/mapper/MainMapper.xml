<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ohgiraffers.semiproject.main.model.dao.MainMapper">

    <resultMap id="projectFileResult" type="com.ohgiraffers.semiproject.project.product.model.dto.ProjectFileDTO">
        <id property="fileCode" column="FILE_CODE"/>
        <result property="originalFileName" column="ORIGINAL_FILE_NAME"/>
        <result property="changedFileName" column="CHANGED_FILE_NAME"/>
        <result property="path" column="PATH"/>
        <result property="creationDate" column="CREATION_DATE"/>
        <result property="deleteStatus" column="DELETE_STATUS"/>
        <result property="fileType" column="FILE_TYPE"/>
        <result property="projectCode" column="PROJECT_CODE"/>
    </resultMap>

    <resultMap id="projectResultMap" type="com.ohgiraffers.semiproject.main.model.dto.ProjectDTO">
        <id property="projectCode" column="PROJECT_CODE"/>
        <result property="projectTitle" column="PROJECT_TITLE"/>
        <result property="projectCategory" column="PROJECT_CATEGORY"/>
        <result property="projectType" column="PROJECT_TYPE"/>
        <result property="projectPlan" column="PROJECT_PLAN"/>
        <result property="targetAmount" column="TARGET_AMOUNT"/>
        <result property="projectSummary" column="PROJECT_SUMMARY"/>
        <result property="policyAgreement" column="POLICY_AGREEMENT"/>
        <result property="progressStatus" column="PROGRESS_STATUS"/>
        <result property="submissionDate" column="SUBMISSION_DATE"/>
        <result property="projectStartDate" column="PROJECT_START_DATE"/>
        <result property="projectEndDate" column="PROJECT_END_DATE"/>
        <result property="achievementStatus" column="ACHIEVEMENT_STATUS"/>
        <result property="sellerInfo" column="SELLER_INFO"/>
        <result property="changedFileName" column="CHANGED_FILE_NAME"/>
    </resultMap>





    <select id="firstNewProject" resultMap="projectResultMap">
        select
            A.PROJECT_TITLE,
            A.PROJECT_CODE,
            C.CHANGED_FILE_NAME
        from
            tbl_project A
                join tbl_approval_history B ON (A.PROJECT_CODE = B.PROJECT_CODE)
                join tbl_project_file C ON (A.PROJECT_CODE = C.PROJECT_CODE)
        where
            A.PROJECT_TYPE = '신규펀딩'
          and    C.FILE_TYPE = 'Representative_image'
          and B.APPROVAL_STATUS = 'Y'
        order by
            A.SUBMISSION_DATE
                ASC
            limit 4;
    </select>

    <select id="secondNewProject" resultMap="projectResultMap">
        select
            A.PROJECT_TITLE,
            A.PROJECT_CODE,
            C.CHANGED_FILE_NAME
        from
            tbl_project A
                join tbl_approval_history B ON (A.PROJECT_CODE = B.PROJECT_CODE)
                join tbl_project_file C ON (A.PROJECT_CODE = C.PROJECT_CODE)
        where
            A.PROJECT_TYPE = '신규펀딩'
          and    C.FILE_TYPE = 'Representative_image'
          and B.APPROVAL_STATUS = 'Y'
        order by
            A.SUBMISSION_DATE
                ASC
            limit 4,4;
    </select>

    <select id="firstReProject"  resultMap="projectResultMap">
        select
            A.PROJECT_TITLE,
            A.PROJECT_CODE,
            C.CHANGED_FILE_NAME
        from
            tbl_project A
                join tbl_approval_history B ON (A.PROJECT_CODE = B.PROJECT_CODE)
                join tbl_project_file C ON (A.PROJECT_CODE = C.PROJECT_CODE)
        where
            A.PROJECT_TYPE = '리펀딩'
          and    C.FILE_TYPE = 'Representative_image'
          and B.APPROVAL_STATUS = 'Y'
        order by
            A.SUBMISSION_DATE
                ASC
            limit 4;
    </select>

    <select id="secondReProject" resultMap="projectResultMap">
        select
            A.PROJECT_TITLE,
            A.PROJECT_CODE,
            C.CHANGED_FILE_NAME
        from
            tbl_project A
                join tbl_approval_history B ON (A.PROJECT_CODE = B.PROJECT_CODE)
                join tbl_project_file C ON (A.PROJECT_CODE = C.PROJECT_CODE)
        where
            A.PROJECT_TYPE = '리펀딩'
          and    C.FILE_TYPE = 'Representative_image'
          and B.APPROVAL_STATUS = 'Y'
        order by
            A.SUBMISSION_DATE
                ASC
            limit 4,4;
    </select>




</mapper>
