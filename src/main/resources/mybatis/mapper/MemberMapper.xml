<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ohgiraffers.semiproject.member.model.dao.MemberMapper">

    <resultMap type="com.ohgiraffers.semiproject.member.model.dto.MemberDTO" id="memberResultMap">
        <id property="userCode" column="USER_CODE"/>
        <result property="userId" column="USER_ID"/>
        <result property="userPwd" column="PASSWORD"/>
        <result property="email" column="EMAIL"/>
        <result property="registrationDate" column="REGISTRATION_DATE"/>
        <result property="address" column="ADDRESS"/>
        <result property="userName" column="USER_NAME"/>
        <result property="dateBirth" column="DATE_BIRTH"/>
        <result property="phone" column="PHONE"/>
        <result property="activityStatus" column="ACTIVITY_STATUS"/>
        <result property="reportCount" column="REPORT_COUNT"/>
        <result property="couponStatus" column="COUPON_STATUS"/>
    </resultMap>
    <resultMap id="AuthorityResultMap" type="com.ohgiraffers.semiproject.member.model.dto.AuthorityDTO">
        <id property="authorityCode" column="AUTHORITY_CODE"/>
        <result property="authorityName" column="AUTHORITY_NAME"/>
        <result property="authorityDescription" column="AUTHORITY_DESCRIPTION"/>
    </resultMap>

    <resultMap id="MemberAndAuthorityResultMap" type="com.ohgiraffers.semiproject.member.model.dto.MemberAndAuthorityDTO">
        <association property="memberDTO" resultMap="memberResultMap"/>
        <association property="authorityDTO" resultMap="AuthorityResultMap"/>

    </resultMap>




    <select id="selectMemberById" resultMap="MemberAndAuthorityResultMap">
        SELECT
            A.USER_ID
        FROM tbl_user A
        WHERE A.ACTIVITY_STATUS = '활동'
          AND A.USER_ID = #{ userId }
    </select>

    <select id="findByMemberId" resultMap="MemberAndAuthorityResultMap">
        SELECT
            A.USER_CODE
             , A.USER_ID
             , A.PASSWORD
             , A.EMAIL
             , A.REGISTRATION_DATE
             , A.ADDRESS
             , A.USER_NAME
             , A.DATE_BIRTH
             , A.PHONE
             , A.ACTIVITY_STATUS
             , A.REPORT_COUNT
             , A.COUPON_STATUS
            , C.AUTHORITY_NAME

        FROM tbl_user A
        JOIN tbl_authority_list B ON (A.USER_CODE = B.USER_CODE)
        JOIN tbl_authority C ON (B.AUTHORITY_CODE = C.AUTHORITY_CODE)
        WHERE A.ACTIVITY_STATUS = '활동'
          AND A.USER_ID = #{ userId }
    </select>

<!--    <insert id="insertMember" parameterType="MemberDTO">-->
<!--        INSERT-->
<!--        INTO tbl_user       (-->
<!--                                USER_NAME-->
<!--                              , USER_ID-->
<!--                              , PASSWORD-->
<!--                              , EMAIL-->
<!--                              , ADDRESS-->
<!--                              , PHONE-->
<!--                              , DATE_BIRTH-->

<!--        )-->
<!--        VALUES  (-->
<!--                    #{userName}-->
<!--                , #{userId}-->
<!--                , #{userPwd}-->
<!--                , #{email}-->
<!--                , #{address}-->
<!--                , #{phone}-->
<!--                , #{dateBirth}-->
<!--                )-->
<!--    </insert>-->

<!--    <select id="selectEncryptedPwd" resultType="string">-->
<!--        SELECT-->
<!--            A.PASSWORD-->
<!--        FROM tbl_user A-->
<!--        WHERE A.ACTIVITY_STATUS = '활동'-->
<!--          AND A.USER_ID = #{userId}-->
<!--    </select>-->

<!--    <select id="selectMember" resultType="MemberDTO">-->
<!--        SELECT-->
<!--            A.USER_CODE-->
<!--             , A.USER_ID-->
<!--             , A.PASSWORD-->
<!--             , A.EMAIL-->
<!--             , A.REGISTRATION_DATE-->
<!--             , A.ADDRESS-->
<!--             , A.USER_NAME-->
<!--             , A.DATE_BIRTH-->
<!--             , A.PHONE-->
<!--             , A.PHONE-->
<!--             , A.ACTIVITY_STATUS-->

<!--        FROM  tbl_user A-->
<!--        WHERE  A.ACTIVITY_STATUS = '활동'-->
<!--          AND  A.MEMBER_ID = #{userId}-->
<!--    </select>-->

<!--    <update id="updateMember">-->
<!--        UPDATE-->
<!--            tbl_user-->
<!--        SET PASSWORD = #{userPwd}-->
<!--          , NICKNAME = #{ nickname }-->
<!--          , PHONE = #{ phone }-->
<!--          , EMAIL = #{ email }-->
<!--          , ADDRESS = #{ address }-->
<!--        WHERE A.ACTIVITY_STATUS = '활동'-->
<!--          AND USER_ID = #{userId}-->
<!--    </update>-->

<!--    <update id="deleteMember">-->
<!--        UPDATE-->
<!--            tbl_user-->
<!--        SET ACTIVITY_STATUS = '휴면'-->
<!--        WHERE ACTIVITY_STATUS = '활동'-->
<!--          AND MEMBER_ID = #{userId}-->
<!--    </update>-->

</mapper>
